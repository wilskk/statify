# Desain Fitur: Tampilan Variabel

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Tampilan Variabel`.

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

Dokumentasi ini berisi diagram sekuens yang menjelaskan alur kerja utama dalam `VariableTable` untuk mengelola metadata variabel. Arsitektur utamanya menggunakan antrean operasi asinkron untuk memastikan semua perubahan, baik yang sederhana maupun kompleks, diproses secara teratur.

---

### 1. Alur Pengeditan Sel Sederhana (Fitur #38, #44)

Diagram ini menunjukkan bagaimana perubahan pada sel input sederhana (seperti `Name` atau `Label`) diproses secara asinkron melalui antrean operasi.

```mermaid
sequenceDiagram
    title: Alur Proses Pengeditan Sel Sederhana
    actor User as "Pengguna"

    box "Frontend"
        participant View as "VariableTable"
        participant Events as "useVariableTableEvents"
        participant Updates as "useVariableTableUpdates"
        participant VarStore as "useVariableStore"
    end

    autonumber

    Pengguna->>+View: Mengedit sel (misal: "Name", "Label")
    View->>+Events: Memicu `handleBeforeChange()`
    Events->>+Updates: `enqueueOperation({ type: 'UPDATE', ... })`
    deactivate Events
    
    Note over Updates: Operasi ditambahkan ke antrean<br/>dan diproses secara FIFO.
    
    Updates->>Updates: `processPendingOperations()`
    Updates->>+VarStore: `updateMultipleFields(payload)`
    deactivate Updates
    
    VarStore-->>View: Notifikasi perubahan state
    deactivate View
end
```

---

### 2. Alur Pengeditan via Dialog (Fitur #39, #40, #41)

Diagram berikut menjelaskan proses saat pengguna berinteraksi dengan sel yang memerlukan dialog (seperti `Type` atau `Values`), yang hasilnya juga dimasukkan ke dalam sistem antrean operasi yang sama.

```mermaid
sequenceDiagram
    title: Alur Proses Pengeditan via Dialog
    actor User as "Pengguna"

    box "Frontend"
        participant View as "VariableTable"
        participant Dialogs as "useVariableTableDialogs"
        participant DialogComp as "Specific Dialog"
        participant Updates as "useVariableTableUpdates"
    end

    autonumber

    Pengguna->>+View: Klik pada sel pemicu dialog (misal: "Values")
    View->>+Dialogs: Memicu `openDialogForCell()`
    Dialogs->>DialogComp: Tampilkan dialog
    
    Pengguna->>DialogComp: Mengubah nilai & klik "OK"
    DialogComp-->>+Dialogs: Callback `onSave(payload)`
    
    Dialogs->>+Updates: `enqueueOperation({ type: 'UPDATE', payload })`
    Note right of Updates: Operasi ditambahkan ke antrean<br/>dan akan diproses (lihat alur pertama).
    deactivate Updates
    
    Dialogs->>DialogComp: Tutup dialog
    deactivate Dialogs
    deactivate View
end
```

---

### 3. Alur Aksi Menu Konteks (Fitur #42)

Diagram ini mengilustrasikan alur kerja saat pengguna menggunakan menu konteks untuk aksi seperti "Insert Variable", yang juga diantrekan untuk pemrosesan yang aman.

```mermaid
sequenceDiagram
    title: Alur Proses Aksi Menu Konteks (Insert Variable)
    actor User as "Pengguna"

    box "Frontend"
        participant View as "VariableTable"
        participant Events as "useVariableTableEvents"
        participant Updates as "useVariableTableUpdates"
        participant VarStore as "useVariableStore"
    end

    autonumber

    Pengguna->>+View: Klik kanan -> "Insert Variable"
    View->>+Events: `handleInsertVariable()`
    
    Events->>+Updates: `enqueueOperation({ type: 'INSERT', ... })`
    deactivate Events
    
    Note over Updates: Operasi ditambahkan ke antrean.
    
    Updates->>Updates: `processPendingOperations()`
    Updates->>+VarStore: `insertVariableAt(index)`
    deactivate Updates
    
    Note right of VarStore: Store menangani pembuatan variabel baru<br/>dan penambahan kolom data terkait.
    
    VarStore-->>View: Notifikasi perubahan state
    deactivate View
end
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek (kelas, atribut, metode baru) yang ditemukan selama desain.*

- **Hooks Baru:**
  - `useVariableTableEvents.ts`: Menangani semua interaksi pengguna langsung dengan grid, seperti edit sel, seleksi, dan pemicu menu konteks.
  - `useVariableTableUpdates.ts`: Mengelola antrean operasi asinkron (buat, perbarui, hapus) untuk memastikan pembaruan state yang andal dan teratur.
  - `useVariableTableDialogs.ts`: Mengelola state untuk membuka dan menutup berbagai dialog edit.
- **Komponen Dialog Baru:**
  - `dialog/VariableTypeDialog.tsx`: Dialog untuk mengubah tipe, lebar, dan desimal variabel.
  - `dialog/ValueLabelsDialog.tsx`: Dialog untuk menambah, mengubah, dan menghapus label nilai.
  - `dialog/MissingValuesDialog.tsx`: Dialog untuk mendefinisikan nilai yang dianggap hilang (missing).
- **Komponen Utama:**
  - `variableTable/index.tsx`: Komponen inti yang mengintegrasikan semua hook, dialog, dan merender grid properti variabel.
- **Utilitas Baru:**
  - `variableTable/utils/utils.ts`: Kumpulan fungsi pembantu untuk memformat nilai (misal: 'Values' dan 'Missing') agar mudah dibaca di dalam grid.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

- **Alternatif 1:** Menggunakan *inline-editing* untuk semua properti variabel, termasuk yang kompleks seperti Value Labels, di dalam sel grid itu sendiri.
  - **Kelebihan:** Pengalaman edit yang konsisten tanpa membuka jendela baru.
  - **Kekurangan:** UI untuk properti kompleks (Value Labels, Missing Values) akan sangat rumit jika diimplementasikan secara inline. Ini akan mengacaukan kebersihan dan kepadatan tampilan grid utama.
- **Keputusan:** Menggunakan dialog (modal) untuk mengedit properti yang lebih kompleks. Pendekatan ini menjaga antarmuka grid utama tetap bersih dan sederhana, sambil menyediakan ruang UI yang luas dan didedikasikan untuk fungsionalitas edit yang rumit, sehingga meningkatkan pengalaman pengguna secara keseluruhan. 