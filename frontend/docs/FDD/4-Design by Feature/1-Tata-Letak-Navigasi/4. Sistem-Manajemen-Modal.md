# Desain Fitur: Sistem Manajemen Modal

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Sistem Manajemen Modal`.

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

Diagram berikut menjelaskan alur kerja terpusat untuk membuka dan menampilkan modal, dari interaksi pengguna hingga perenderan komponen. Diagram ini telah diperbarui untuk memberikan detail yang lebih baik dan kejelasan alur.

```mermaid
sequenceDiagram
    autonumber
    actor User as "Pengguna"

    box "Antarmuka Pengguna (UI)"
        participant MenuItem as "Menu Item (misal: File > Open)"
    end

    box "Sistem Manajemen Modal"
        participant Store as "useModalStore (Zustand)"
        participant Manager as "ModalManager"
        participant Registry as "ModalRegistry"
        participant Renderer as "ModalRenderer"
    end
    
    participant SpecificModal as "Komponen Modal Spesifik<br/>(misal: OpenFileModal)"

    User->>MenuItem: 1. Klik pada item menu
    activate MenuItem
    
    MenuItem->>Store: 2. Panggil `openModal('namaModal', { props })`
    deactivate MenuItem
    activate Store
    
    Note right of Store: State store berubah: `activeModal` & `modalProps` diperbarui.
    
    Store-->>Manager: 3. Memicu `ModalManager` (via re-render)
    deactivate Store
    activate Manager

    Manager->>Registry: 4. `getModalComponent('namaModal')`
    activate Registry
    Registry-->>Manager: 5. Kembalikan komponen
    deactivate Registry
    
    Manager->>Renderer: 6. Teruskan komponen dan props
    activate Renderer
    
    Renderer->>SpecificModal: 7. Render komponen modal
    activate SpecificModal

    SpecificModal-->>User: 8. Tampilkan dialog modal
    deactivate SpecificModal
    deactivate Renderer
    deactivate Manager
end
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek (kelas, atribut, metode baru) yang ditemukan selama desain.*

- **Kelas/Hooks Baru:**
  - `useModalStore.ts`: Store terpusat (Zustand) untuk mengelola state semua modal.
  - `ModalRegistry.tsx`: Sebuah registry (peta) untuk mendaftarkan semua komponen modal yang tersedia berdasarkan ID unik.
  - `ModalManager.tsx`: Komponen yang "mendengarkan" perubahan pada `useModalStore` dan mengelola siklus hidup modal.
  - `ModalRenderer.tsx`: Komponen yang bertanggung jawab untuk merender modal aktif dengan "pembungkus" yang sesuai (misalnya, dialog, sidebar).
  - `TourComponents.tsx`: Komponen yang menyediakan UI untuk pemandu tur interaktif aplikasi, yang juga dikelola melalui sistem modal.

- **Atribut/Metode Baru (pada `useModalStore.ts`):**
  - `activeModal: string | null`: Menyimpan ID modal yang sedang aktif.
  - `modalProps: any`: Menyimpan props yang diteruskan ke modal aktif.
  - `openModal(id, props)`: Fungsi untuk membuka modal berdasarkan ID dan meneruskan props.
  - `closeModal()`: Fungsi untuk menutup modal yang sedang aktif.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

- **Alternatif 1:** Setiap komponen menu mengimpor dan merender modalnya sendiri secara langsung menggunakan state lokal (`useState`).
  - **Kelebihan:** Implementasi yang sangat sederhana dan langsung untuk kasus tunggal.
  - **Kekurangan:** Pengelolaan state menjadi tersebar dan sulit dilacak. Tidak ada cara terpusat untuk memastikan hanya satu modal yang aktif pada satu waktu, dan akan terjadi duplikasi logika untuk membuka/menutup modal.
- **Keputusan:** Menggunakan store terpusat (`Zustand`) dan sistem registry. Arsitektur ini memberikan "single source of truth" untuk state modal, memisahkan *concern* (pemicu vs. perender), dan memungkinkan sistem yang jauh lebih skalabel, dapat diuji, dan mudah dikelola. 