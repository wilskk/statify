# Desain Fitur: Dialog Analisis Frekuensi

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Dialog Analisis Frekuensi`.

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

*Diagram ini menunjukkan alur kerja komprehensif untuk analisis Frekuensi, mulai dari interaksi pengguna dan manajemen state otomatis dengan IndexedDB, hingga eksekusi analisis oleh web worker dan pembuatan output statistik serta grafik.*

### **Sequence Diagram: Alur Kerja Analisis Frekuensi Modern**

```mermaid
sequenceDiagram
    title: Alur Kerja Analisis Frekuensi Modern
    actor User

    box "Frontend: Komponen & State"
        participant View as "FrequenciesContent<br>/Frequencies/index.tsx"
        participant VarHook as "useVariableSelection"
        participant StatsHook as "useStatisticsSettings"
        participant ChartsHook as "useChartsSettings"
        participant DisplayHook as "useDisplaySettings"
        participant IndexedDB as "IndexedDB"
    end
    
    box "Frontend: Logika Analisis"
        participant AnalysisHook as "useFrequenciesAnalysis"
        participant WorkerPool as "Worker Pool"
        participant Worker as "Frequencies Worker"
        participant ResultStore as "useResultStore"
    end

    %% Inisialisasi & Memuat State dari IndexedDB
    activate View
    View->>IndexedDB: getFormData("Frequencies")
    IndexedDB-->>View: Mengembalikan state tersimpan (jika ada)
    View->>VarHook: Inisialisasi variabel
    View->>StatsHook: Inisialisasi opsi statistik
    View->>ChartsHook: Inisialisasi opsi grafik
    deactivate View

    %% Interaksi Pengguna & Penyimpanan State Otomatis
    User->>+View: Memilih variabel atau mengubah opsi di tab manapun
    View->>+StatsHook: Memperbarui state statistik (contoh)
    View->>IndexedDB: saveFormData("Frequencies", newState)
    Note right of View: State disimpan otomatis ke IndexedDB<br/>setiap ada perubahan konfigurasi.
    deactivate View
    deactivate StatsHook
    
    %% Menjalankan Analisis
    User->>+View: Klik tombol "OK"
    View->>+AnalysisHook: runAnalysis()
    
    activate AnalysisHook
    AnalysisHook->>AnalysisHook: `isLoading = true`, validasi input
    AnalysisHook->>AnalysisHook: buildFrequenciesLog() (membuat log perintah SPSS)
    AnalysisHook->>ResultStore: addLog(logMessage)
    AnalysisHook->>ResultStore: addAnalytic(...)
    Store-->>AnalysisHook: analyticId
    
    AnalysisHook->>WorkerPool: createPooledWorkerClient('frequencies')
    WorkerPool-->>AnalysisHook: workerClient
    
    AnalysisHook->>+Worker: postMessage({ variableData, options, ... })
    Note right of Worker: Mengirim satu pesan tunggal<br/>berisi semua variabel & opsi.

    %% Menerima dan Memproses Hasil Tunggal dari Worker
    Worker-->>-AnalysisHook: onmessage = { success, results, ... }
    
    rect rgb(230, 240, 255)
        note over AnalysisHook, ResultStore: Proses & Simpan Berbagai Output
        opt Jika `showStatistics` aktif
            AnalysisHook->>AnalysisHook: formatStatisticsTable(results.statistics)
            AnalysisHook->>ResultStore: addStatistic({ title: "Statistics", ... })
        end
        
        opt Jika `showFrequencyTables` aktif
            loop untuk setiap variabel dalam `results.frequencyTables`
                AnalysisHook->>AnalysisHook: formatFrequencyTable(...)
                AnalysisHook->>ResultStore: addStatistic({ title: "Frequency Table", ... })
            end
        end
        
        opt Jika `showCharts` aktif
            AnalysisHook->>AnalysisHook: processAndAddCharts(results.frequencyTables, chartOptions)
            Note right of AnalysisHook: Membuat dan menyimpan<br/>output grafik (Bar, Pie, Histo).
        end
    end
    
    AnalysisHook->>AnalysisHook: `isLoading = false`
    AnalysisHook->>View: onClose()
    deactivate AnalysisHook
    deactivate View
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek yang ditemukan selama desain.*

-   **Komponen Bertab:**
    -   `Frequencies/index.tsx`: Komponen induk yang mengintegrasikan semua *hooks* dan mengelola UI utama.
    -   `VariablesTab.tsx`: UI untuk memilih variabel dan mengelola opsi tampilan dasar.
    -   `StatisticsTab.tsx`: UI kompleks untuk memilih berbagai statistik (persentil, tendensi sentral, dispersi, distribusi).
    -   `ChartsTab.tsx`: UI untuk memilih jenis grafik (Bar, Pie, Histogram).
-   **Hook Logika & Utilitas:**
    -   `hooks/useVariableSelection.ts`: Mengelola state untuk daftar variabel yang dipilih.
    -   `hooks/useStatisticsSettings.ts`: Mengelola state untuk semua opsi statistik yang dapat dikonfigurasi pada tab "Statistics".
    -   `hooks/useChartsSettings.ts`: Mengelola state untuk semua opsi grafik pada tab "Charts".
    -   `hooks/useDisplaySettings.ts`: Mengelola state untuk opsi tampilan (misalnya, menampilkan tabel frekuensi).
    -   `hooks/useFrequenciesAnalysis.ts`: Hook orkestrator utama yang:
        -   Mengumpulkan semua konfigurasi dari *hooks* lain.
        -   Membuat log perintah gaya SPSS.
        -   Mengirim satu tugas komprehensif ke *worker pool*.
        -   Menerima hasil tunggal dari *worker*.
        -   Memanggil berbagai *formatter* dan *processor* untuk menghasilkan semua output yang diminta (tabel statistik, tabel frekuensi, dan grafik).
        -   Menyimpan semua output ke `useResultStore`.
    -   `hooks/useIndexedDB.ts`: Menyediakan persistensi state otomatis untuk dialog.
-   **Web Worker:**
    -   Worker khusus untuk analisis Frekuensi yang dirancang untuk memproses beberapa variabel dalam satu kali jalan, menghitung tabel frekuensi dan semua statistik yang diminta secara efisien.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

-   **Keputusan:** **Pemisahan Logika Konfigurasi ke Hooks.** Dengan banyaknya opsi di tab Statistik dan Grafik, memisahkannya ke dalam `useStatisticsSettings` dan `useChartsSettings` membuat state management menjadi jauh lebih terorganisir dan terkelola dibandingkan dengan menyimpannya semua di komponen utama.
-   **Keputusan:** **Tugas Worker Tunggal vs. Ganda.** Berbeda dengan analisis Deskriptif atau Eksplorasi yang mengirim tugas per variabel atau per kelompok, Frekuensi mengirim satu tugas besar berisi semua variabel. Ini lebih efisien untuk kasus penggunaan Frekuensi di mana *worker* dapat mengulang data sekali dan menghitung statistik untuk semua variabel yang diminta dalam satu proses terpadu.
-   **Keputusan:** **Pemroses Output Modular.** Setelah hasil diterima dari *worker*, hook `useFrequenciesAnalysis` tidak langsung memanipulasi DOM atau data. Sebaliknya, ia mendelegasikan tugas ke fungsi-fungsi yang lebih kecil dan murni (`format...`, `process...`) untuk mengubah data mentah menjadi struktur tabel atau grafik yang siap ditampilkan. Ini meningkatkan keterbacaan dan kemudahan pengujian.

--- 