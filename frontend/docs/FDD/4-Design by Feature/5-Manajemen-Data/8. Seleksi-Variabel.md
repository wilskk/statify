# Desain Fitur: Seleksi Variabel

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Seleksi Variabel`.

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

*Diagram ini menunjukkan alur untuk mengurutkan variabel berdasarkan atributnya.*

### **Sequence Diagram: Set Measurement Level**

Dokumentasi ini berisi diagram sekuens yang merinci alur kerja fitur "Set Measurement Level", yang memungkinkan pengguna untuk dengan cepat menetapkan level pengukuran untuk variabel yang belum terdefinisi.

---

### 1. Alur Proses Penetapan Level Pengukuran

Diagram ini menunjukkan bagaimana pengguna memindahkan variabel antar-daftar untuk menetapkan level pengukurannya, dan bagaimana perubahan tersebut disimpan ke `VariableStore` saat dikonfirmasi.

```mermaid
sequenceDiagram
    title: Alur Proses Penetapan Level Pengukuran
    actor User

    box "Frontend Components"
        participant UI as "SetMeasurementLevelUI<br>.../SetMeasurementLevel/SetMeasurementLevelUI.tsx"
    end
    
    box "Hooks & Stores"
        participant Hook as "useSetMeasurementLevel<br>.../hooks/useSetMeasurementLevel.ts"
        participant VarStore as "useVariableStore"
    end

    User->>+UI: Buka modal "Set Measurement Level"
    UI->>+Hook: Inisialisasi hook
    Hook->>+VarStore: Get all variables
    deactivate VarStore
    Hook->>Hook: Filter untuk variabel dengan measure 'unknown'
    Hook-->>-UI: Return state awal (unknownVariables)
    UI-->>User: Tampilkan modal dengan variabel yang belum diketahui

    User->>UI: Pindahkan variabel dari 'Unknown' ke 'Nominal'
    UI->>+Hook: handleMoveVariable(...)
    Hook->>Hook: Memperbarui state internal (menghapus dari satu daftar, menambah ke daftar lain)
    Hook-->>-UI: Return state yang diperbarui
    deactivate Hook

    User->>UI: Klik tombol "OK"
    UI->>+Hook: handleSave()

    loop untuk setiap variabel di daftar Nominal, Ordinal, dan Scale
        Hook->>+VarStore: updateVariable(columnIndex, "measure", newMeasure)
        deactivate VarStore
    end

    Hook->>UI: onClose()
    deactivate Hook
    deactivate UI
```

### **Sequence Diagram: Sort Variables**

Dokumentasi ini berisi diagram sekuens yang merinci alur kerja fitur "Sort Variables", yang memungkinkan pengguna untuk mengurutkan kolom data berdasarkan atribut variabel (misalnya, nama, jenis, label).

---

### 1. Alur Proses Pengurutan Variabel

Diagram ini menunjukkan bagaimana pengguna memilih kriteria pengurutan, yang kemudian digunakan untuk mengurutkan ulang definisi variabel di `VariableStore` dan kolom data di `DataStore`.

```mermaid
sequenceDiagram
    title: Alur Proses Pengurutan Variabel (Kolom)
    actor User

    box "Frontend Components"
        participant UI as "SortVarsUI<br>.../SortVars/SortVarsUI.tsx"
    end

    box "Hooks & Services"
        participant Hook as "useSortVariables<br>.../hooks/useSortVariables.ts"
        participant Service as "sortVarsService<br>.../services/sortVarsService.ts"
    end
    
    box "Zustand Stores"
        participant VarStore as "useVariableStore"
        participant DataStore as "useDataStore"
    end

    User->>+UI: Buka modal "Sort Variables"
    UI->>+Hook: Inisialisasi hook
    Hook-->>-UI: Return state awal
    UI-->>User: Tampilkan modal dengan atribut variabel

    User->>UI: Pilih kolom untuk diurutkan & urutan pengurutan
    UI->>+Hook: handleSelectColumn(...) & setSortOrder(...)
    Hook-->>-UI: Update UI dengan pilihan
    deactivate Hook

    User->>UI: Klik tombol "OK"
    UI->>+Hook: handleOk()

    Hook->>+VarStore: Get variables
    VarStore-->>-Hook: originalVariables
    
    Hook->>Hook: Mengurutkan array variabel berdasarkan kolom yang dipilih
    note right of Hook: Membuat `sortedVariables`

    Hook->>+VarStore: overwriteVariables(sortedVariables)
    deactivate VarStore

    Hook->>+Service: sortDataColumns(data, originalVariables, sortedVariables)
    Service->>Service: Membuat pemetaan dan mengurutkan ulang kolom data
    Service-->>-Hook: Return newData
    deactivate Service

    Hook->>+DataStore: setData(newData)
    deactivate DataStore

    Hook->>UI: onClose()
    deactivate Hook
    deactivate UI
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek (kelas, atribut, metode baru) yang ditemukan selama desain.*

- **Komponen:**
  - `SetMeasurementLevel/SetMeasurementLevelUI.tsx`: UI untuk memilih variabel dan menerapkan level pengukuran baru.
  - `SortVars/SortVarsUI.tsx`: UI untuk memilih atribut (Nama, Tipe, Label) sebagai dasar pengurutan.
- **Hook Logika:**
  - `useSetMeasurementLevel.ts`: Menerapkan perubahan level pengukuran ke variabel yang dipilih melalui `MetaService`.
  - `useSortVariables.ts`: Berisi logika untuk mengambil daftar variabel, mengurutkannya di klien, dan kemudian mengirimkan array urutan baru ke `MetaService`.
- **State Management:**
  - Urutan variabel tidak diubah dengan mengurutkan array `variables` secara fisik di `useMetaStore`. Sebaliknya, sebuah array string terpisah yang berisi nama variabel dalam urutan yang benar disimpan. Ini lebih efisien dan mencegah masalah sinkronisasi.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

- **Alternatif 1:** Mengizinkan pengguna mengurutkan variabel hanya dengan drag-and-drop di Tampilan Variabel.
  - **Kelebihan:** Sangat intuitif untuk mengubah urutan beberapa variabel.
  - **Kekurangan:** Tidak efisien untuk mengurutkan dataset dengan ratusan variabel secara alfabetis.
- **Keputusan:** Menyediakan kedua metode. Drag-and-drop di Tampilan Variabel sangat baik untuk penyesuaian kecil. Dialog `SortVariables` menyediakan alat yang ampuh untuk pengurutan otomatis berdasarkan atribut, yang merupakan kebutuhan umum dalam manajemen data.

--- 