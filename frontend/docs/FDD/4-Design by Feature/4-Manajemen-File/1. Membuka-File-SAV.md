# Desain Fitur: Membuka File SAV

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Membuka File SAV`.

---

## 1. Work Package

- **Fitur yang Dikerjakan:**
  - Membuka dialog untuk membuka file .sav.
  - Memilih file .sav dari komputer pengguna.
  - Memilih file .sav melalui mekanisme seret dan lepas (drag and drop).
  - Mengirim file untuk diproses dan memuat data ke aplikasi.
  - Menampilkan panduan tur untuk fitur membuka file .sav.
- **Tim Fitur (Class Owners):**
  - `[Nama Tim/Developer]`
- **Jadwal (Estimasi):**
  - **Walkthrough:** `[Tanggal]`
  - **Design:** `[Tanggal]`
  - **Design Review:** `[Tanggal]`

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

*Diagram ini menunjukkan alur di mana pengguna memilih file .sav, yang kemudian diunggah ke server untuk diproses, dan hasilnya dikirim kembali untuk memperbarui state aplikasi.*

### **Sequence Diagram: Open .sav File**

Dokumentasi ini berisi diagram sekuens yang merinci alur kerja saat pengguna membuka file data `.sav`.

---

### 1. Alur Proses Membuka File .sav

Diagram ini menunjukkan bagaimana pengguna memilih file, yang kemudian dikirim ke backend untuk diproses. Data yang telah diproses kemudian digunakan untuk memperbarui state aplikasi di frontend.

```mermaid
sequenceDiagram
    title: Alur Proses Membuka File .sav
    actor User as "Pengguna"

    box "Frontend"
        participant View as "OpenSavFileModal<br>/Modals/File/OpenSavFile/index.tsx"
        participant Hook as "useOpenSavFileLogic<br>.../hooks/useOpenSavFileLogic.ts"
        participant Stores as "Zustand Stores"
        participant API as "APIService<br>.../services/services.ts"
    end

    box "Backend"
        participant Endpoint as "Backend Endpoint<br>POST /api/sav/upload"
    end

    autonumber

    Pengguna->>+View: Buka modal & pilih file `.sav`
    View->>+Hook: Panggil `handleFileChange(file)`
    Hook-->>-View: Perbarui state dengan file yang dipilih
    deactivate Hook

    Pengguna->>View: Klik tombol "Open"
    View->>+Hook: Panggil `handleSubmit()`
    
    Hook->>+Stores: Reset state: panggil `resetData()`, `resetVariables()`, `resetMeta()`
    Stores-->>-Hook: Selesai reset
    
    Hook->>+API: Panggil `processSavFile(file)`
    API->>+Endpoint: POST request dengan FormData berisi file
    Endpoint->>Endpoint: Parse file .sav
    Endpoint-->>-API: Kembalikan data (variabel, baris, metadata) dalam format JSON
    API-->>-Hook: Kembalikan respons JSON
    
    Hook->>Hook: Memetakan respons JSON ke struktur data frontend
    Note right of Hook: - `sysvars` -> `Variable[]`<br>- `valueLabels` -> `Variable.values`<br>- `rows` -> `string[][]`
    
    Hook->>+Stores: Panggil `overwriteVariables(newVars)`, `setData(newData)`,<br>`setMeta(newMeta)`
    Stores-->>-Hook: Selesai memperbarui state
    
    Hook->>View: Panggil `onClose()`
    deactivate Hook
    View-->>Pengguna: Tutup modal dan tampilkan data baru
    deactivate View
end
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek (kelas, atribut, metode baru) yang ditemukan selama desain.*

- **Komponen Modal:**
  - `components/Modals/File/OpenSavFile/index.tsx`: Komponen utama yang menampilkan UI untuk unggah file, termasuk area drag-and-drop.
- **Hook Logika:**
  - `components/Modals/File/OpenSavFile/hooks/useOpenSavFileLogic.ts`: Mengelola state modal (misalnya, status loading), menangani pemilihan file, memanggil service API, dan memicu pembaruan data aplikasi setelah file berhasil diproses.
- **Ketergantungan:**
  - Bergantung pada `ClientSavService` untuk berkomunikasi dengan backend.
  - Bergantung pada `DataService` untuk memuat data baru ke dalam state aplikasi.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

- **Alternatif 1:** Menggabungkan semua logika (penanganan file, panggilan API, pembaruan state) langsung di dalam komponen modal.
  - **Kelebihan:** Cepat untuk implementasi awal.
  - **Kekurangan:** Komponen menjadi sangat besar, sulit dibaca, dan sulit diuji. Mencampuradukkan logika tampilan dengan logika bisnis.
- **Keputusan:** Memisahkan logika ke dalam custom hook (`useOpenSavFileLogic`). Ini membuat komponen UI tetap fokus pada presentasi (tampilan), sementara semua logika bisnis yang kompleks dikelola secara terpisah. Pola ini meningkatkan keterbacaan, keterpeliharaan, dan kemudahan pengujian.

---

## 3. Laporan Inspeksi Desain (Design Inspection Report)

- **Hasil:** `[Diterima / Diterima dengan Revisi / Ditolak]`
- **Cacat yang Ditemukan:**
  1. `[Deskripsi Cacat 1]`
- **Daftar Tugas (To-Do List):**
  - `[Tindakan perbaikan 1]` 