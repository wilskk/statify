# Desain Fitur: Mengimpor Data dari CSV

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Mengimpor Data dari CSV`.

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

*Sama seperti impor clipboard, fitur ini menggunakan alur wizard dua langkah: (1) Pemilihan file, dan (2) Konfigurasi dan impor data.*

---
#### 1. Tahap 1: Pemilihan File

Diagram ini menunjukkan bagaimana pengguna memilih file CSV dan melanjutkan ke tahap konfigurasi.

```mermaid
sequenceDiagram
    title: Alur Proses Import dari CSV - Tahap 1: Pemilihan File
    actor User as "Pengguna"

    box "Frontend"
        participant Modal as "ImportCsvModal<br>/Modals/File/ImportCsv/index.tsx"
        participant View as "SelectionStep<br>.../components/ImportCsvSelection.tsx"
    end

    autonumber

    Pengguna->>+Modal: Buka modal "Import from CSV"
    Modal->>View: Render komponen SelectionStep
    deactivate Modal

    alt "Pilih File via Klik"
        Pengguna->>View: Klik tombol "Pilih File" & memilih file
        View-->>Modal: Panggil `onFileSelect(file)`
    else "Pilih File via Drag & Drop"
        Pengguna->>View: Drag & drop file ke area
        View-->>Modal: Panggil `onFileSelect(file)`
    end

    Pengguna->>View: Klik tombol "Continue"
    View-->>+Modal: Memicu `handleContinueToConfigure()`
    Note right of Modal: Simpan file & atur `stage: 'configure'`
    Modal-->>Modal: Render ulang untuk tahap berikutnya
    deactivate Modal
end
```

---
#### 2. Tahap 2: Konfigurasi & Impor

Setelah file dipilih, diagram ini menjelaskan bagaimana pengguna mengonfigurasi opsi parsing, melihat pratinjau, dan akhirnya mengimpor data.

```mermaid
sequenceDiagram
    title: Alur Proses Import dari CSV - Tahap 2: Konfigurasi & Impor
    actor User as "Pengguna"

    box "Frontend"
        participant Modal as "ImportCsvModal<br>/Modals/File/ImportCsv/index.tsx"
        participant View as "ConfigStep<br>.../components/ImportCsvConfiguration.tsx"
        participant Processor as "useImportCsvProcessor<br>.../hooks/useImportCsvProcessor.ts"
        participant Stores as "Zustand Stores"
    end
    
    autonumber

    Modal->>+View: Render ConfigStep dengan `file`
    View->>+Processor: Panggil `generatePreview(file)` untuk preview awal
    Processor-->>-View: Kembalikan `previewData`
    View-->>Pengguna: Tampilkan UI konfiguasi & preview data

    loop Pengguna mengubah opsi
        Pengguna->>View: Ubah delimiter, header, dll.
        View->>+Processor: Panggil `generatePreview(file, options)` dengan opsi baru
        Processor-->>-View: Kembalikan `previewData` yang diperbarui
        View-->>Pengguna: Update tampilan preview
    end

    Pengguna->>View: Klik tombol "Import"
    View->>+Processor: Panggil `processCsvFile(file, options)`
    Processor->>Processor: Parse file menggunakan PapaParse
    Processor->>+Stores: Panggil `setData()` & `overwriteVariables()`
    Stores-->>-Processor: Selesai memperbarui state
    Processor-->>-View: Proses impor selesai
    
    View-->>Modal: Panggil `onClose()` (dari props)
    deactivate View
    deactivate Processor
    Modal-->>Pengguna: Tutup modal
    deactivate Modal
end
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek (kelas, atribut, metode baru) yang ditemukan selama desain.*

- **Komponen Bertingkat:**
  - `ImportCsvSelection.tsx`: UI untuk langkah pemilihan file (termasuk drag-and-drop).
  - `ImportCsvConfiguration.tsx`: UI untuk langkah konfigurasi dan pratinjau data.
- **Hook Logika:**
  - `ImportCsv/index.tsx`: Bertindak sebagai controller yang mengelola langkah wizard saat ini.
  - `useImportCsvProcessor.ts`: Menangani pembacaan file `File` object, melakukan parsing berdasarkan opsi yang diberikan, dan memuat data ke `DataService`.
- **Dependensi:**
  - Menggunakan library `PapaParse` di klien untuk parsing file CSV yang efisien.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

- **Alternatif 1:** Mengirim file CSV ke backend untuk di-parsing.
  - **Kelebihan:** Konsisten dengan alur kerja file `.sav`.
  - **Kekurangan:** Menimbulkan lalu lintas jaringan yang tidak perlu untuk file teks yang dapat dengan mudah di-parse di klien. Menghilangkan kemampuan untuk memberikan pratinjau konfigurasi secara real-time.
- **Keputusan:** Melakukan parsing CSV sepenuhnya di sisi klien. Library seperti `PapaParse` sangat cepat dan efisien. Ini memungkinkan pratinjau data yang instan saat pengguna mengubah opsi (misalnya, mengubah delimiter), memberikan pengalaman pengguna yang jauh lebih baik. 