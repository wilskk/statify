# Desain Fitur: Mengekspor Data ke Excel

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Mengekspor Data ke Excel`.

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

*Diagram ini menunjukkan alur kerja untuk mengekspor data ke file Excel, termasuk pembuatan beberapa lembar kerja (sheet) untuk data dan metadata.*

### **Sequence Diagram: Export to Excel**

Dokumentasi ini berisi diagram sekuens yang merinci alur kerja fitur ekspor data ke format Excel.

---

### 1. Alur Proses Ekspor ke Excel

Diagram ini menunjukkan interaksi antara komponen UI, hook, utilitas, dan pustaka eksternal saat pengguna mengekspor data.

```mermaid
sequenceDiagram
    title: Alur Proses Ekspor Data ke Excel
    actor User as "Pengguna"

    box "Frontend Components"
        participant View as "ExportExcel (View)<br>/Modals/File/ExportExcel/index.tsx"
        participant Hook as "useExportExcelLogic<br>/Modals/File/ExportExcel/hooks/useExportExcelLogic.ts"
        participant Utils as "excelExporter<br>/Modals/File/ExportExcel/utils/excelExporter.ts"
    end

    box "Zustand Stores"
        participant DataStore as "useDataStore"
        participant VarStore as "useVariableStore"
        participant MetaStore as "useMetaStore"
    end
    
    box "External Library"
        participant XLSX
    end

    autonumber

    Pengguna->>+View: Buka modal "Export to Excel"
    View->>+Hook: Inisialisasi hook `useExportExcelLogic`
    Hook->>MetaStore: Ambil `meta.name` untuk nama file awal
    MetaStore-->>Hook: Kembalikan metadata
    Hook-->>-View: Mengembalikan state awal (opsi ekspor)
    View-->>Pengguna: Tampilkan modal dengan opsi

    loop Pengguna mengubah opsi
        Pengguna->>View: Ubah nama file atau opsi lainnya
        View->>+Hook: Panggil `handleChange()` atau `handleFilenameChange()`
        Hook->>Hook: Perbarui state `exportOptions`
        Hook-->>-View: Kembalikan state yang diperbarui
        deactivate Hook
    end

    Pengguna->>View: Klik tombol "Export"
    View->>+Hook: Panggil `handleExport()`
    Hook->>DataStore: Ambil data
    DataStore-->>Hook: Kembalikan data
    Hook->>VarStore: Ambil variabel
    VarStore-->>Hook: Kembalikan variabel
    Hook->>MetaStore: Ambil metadata
    MetaStore-->>Hook: Kembalikan metadata
    
    Hook->>+Utils: Panggil `generateExcelWorkbook(data, vars, meta, options)`
    Utils-->>-Hook: Kembalikan objek `workbook`
    
    Hook->>+XLSX: Panggil `XLSX.writeFile(workbook, filename)`
    Note right of XLSX: Pustaka menangani pembuatan file<br>dan memicu unduhan di browser.
    XLSX-->>Pengguna: Munculkan dialog unduh file
    deactivate XLSX
    
    Hook->>View: Panggil `onClose()`
    deactivate Hook
    View-->>-Pengguna: Tutup modal
    deactivate View
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek (kelas, atribut, metode baru) yang ditemukan selama desain.*

- **Komponen Modal:**
  - `ExportExcel/index.tsx`: Komponen utama yang berisi UI untuk opsi ekspor Excel.
- **Hook Logika:**
  - `useExportExcelLogic.ts`: Mengelola state opsi. Mengambil data yang relevan dari berbagai store. Menggunakan `SheetJS` untuk secara programatik membangun workbook Excel:
    1. Membuat worksheet dari data utama.
    2. Membuat worksheet kedua dari properti variabel.
    3. Membuat worksheet ketiga untuk metadata file.
    4. Menulis workbook yang sudah jadi ke buffer biner.
    5. Memicu pengunduhan buffer tersebut sebagai file.
- **Dependensi:**
  - `SheetJS` (`xlsx`): Digunakan untuk membuat file spreadsheet secara dinamis di klien.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

- **Alternatif 1:** Hanya mengekspor data mentah ke satu sheet.
  - **Kelebihan:** Implementasi lebih sederhana.
  - **Kekurangan:** Kehilangan informasi kontekstual yang kaya seperti properti variabel (value labels, missing values) yang penting bagi analis data.
- **Keputusan:** Menyertakan sheet tambahan untuk properti variabel dan metadata. Ini meniru fungsionalitas paket statistik desktop dan sangat meningkatkan kegunaan file yang diekspor, menjadikannya 'self-documenting'. 