# Desain Fitur: Mengimpor Data dari Excel

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Mengimpor Data dari Excel`.

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

*Diagram ini menunjukkan alur wizard dua langkah untuk impor Excel: (1) Pemilihan file, dan (2) Konfigurasi sheet, rentang, dan impor data.*

---
#### 1. Tahap 1: Pemilihan dan Parsing File

Diagram ini menunjukkan bagaimana pengguna memilih file Excel dan file tersebut di-parse di frontend untuk mengekstrak metadata sheet.

```mermaid
sequenceDiagram
    title: Alur Proses Import dari Excel - Tahap 1: Pemilihan File
    actor User as "Pengguna"

    box "Frontend"
        participant Modal as "ImportExcelModal<br>.../File/ImportExcel/index.tsx"
        participant View as "SelectionStep<br>.../components/ImportExcelSelectionStep.tsx"
        participant Parser as "SheetJS (xlsx)"
    end

    autonumber

    Pengguna->>+Modal: Buka modal "Import from Excel"
    Modal->>View: Render komponen SelectionStep
    deactivate Modal

    Pengguna->>View: Pilih file Excel
    
    View->>+Parser: Panggil `readFile(file)`
    Parser->>Parser: Parse workbook untuk mendapatkan nama-nama sheet
    Parser-->>-View: Kembalikan `sheetNames` dan `workbook` object
    
    View-->>+Modal: Panggil `onFileParsed(workbook, sheetNames)`
    Note right of Modal: Simpan workbook, sheetNames & atur `stage: 'configure'`
    Modal-->>Modal: Render ulang untuk tahap berikutnya
    deactivate Modal
end
```

---
#### 2. Tahap 2: Konfigurasi & Impor

Setelah file di-parse, diagram ini menjelaskan bagaimana pengguna memilih sheet, mengatur rentang, melihat pratinjau, dan mengimpor data.

```mermaid
sequenceDiagram
    title: Alur Proses Import dari Excel - Tahap 2: Konfigurasi & Impor
    actor User as "Pengguna"

    box "Frontend"
        participant Modal as "ImportExcelModal<br>.../File/ImportExcel/index.tsx"
        participant View as "ConfigStep<br>.../components/ImportExcelConfigurationStep.tsx"
        participant Stores as "Zustand Stores"
        participant Parser as "SheetJS (xlsx)"
    end
    
    autonumber

    Modal->>+View: Render ConfigStep dengan `workbook` & `sheetNames`
    View-->>Pengguna: Tampilkan UI untuk memilih sheet/rentang

    loop Pengguna mengubah opsi
        Pengguna->>View: Pilih sheet atau ubah rentang
        View->>+Parser: Panggil utilitas untuk mengekstrak data dari `workbook`
        Note right of Parser: `utils.sheet_to_json(worksheet, ...)`
        Parser-->>-View: Kembalikan `previewData`
        View-->>Pengguna: Update tampilan preview data
    end

    Pengguna->>View: Klik tombol "Import"
    View->>View: Ambil data final berdasarkan opsi terakhir
    View->>+Stores: Panggil `setData()` & `overwriteVariables()`
    Stores-->>-View: Selesai memperbarui state
    
    View-->>Modal: Panggil `onClose()`
    deactivate View
    Modal-->>Pengguna: Tutup modal
    deactivate Modal
end
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek (kelas, atribut, metode baru) yang ditemukan selama desain.*

- **Komponen Bertingkat:**
  - `ImportExcelSelectionStep.tsx`: UI untuk langkah pemilihan file.
  - `ImportExcelConfigurationStep.tsx`: UI untuk langkah konfigurasi (pilih sheet, atur rentang) dan pratinjau data.
- **Logika:**
  - Parsing file Excel dilakukan di klien menggunakan library seperti `SheetJS` (`xlsx`).
  - Logika untuk mengekstrak data dari sheet dan rentang yang dipilih berada dalam komponen konfigurasi atau hook terkait.
- **Dependensi:**
  - `SheetJS` (`xlsx`): Library standar industri untuk membaca dan menulis spreadsheet dalam JavaScript, sepenuhnya berjalan di klien.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

- **Alternatif 1:** Hanya mengizinkan impor dari sheet pertama saja.
  - **Kelebihan:** Menyederhanakan UI secara drastis.
  - **Kekurangan:** Sangat membatasi dan tidak memenuhi ekspektasi pengguna yang umum saat bekerja dengan file Excel yang seringkali memiliki banyak sheet.
- **Keputusan:** Memberikan fungsionalitas penuh untuk memilih sheet dan rentang. Meskipun ini menambah kompleksitas pada UI, ini adalah fitur penting untuk impor dari Excel dan memberikan fleksibilitas yang dibutuhkan pengguna. Menggunakan `SheetJS` membuat implementasi teknisnya menjadi lebih mudah. 