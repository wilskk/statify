# Desain Fitur: Mengekspor Data ke CSV

Dokumen ini berisi paket desain (Design Package) untuk Feature Set `Mengekspor Data ke CSV`.

---

## 2. Design Package

### 2.1. Diagram Urutan (Sequence Diagrams)

*Diagram ini menunjukkan alur ekspor, mulai dari pengambilan data hingga pembuatan file CSV yang dapat diunduh.*

### **Sequence Diagram: Export to CSV**

Dokumentasi ini berisi diagram sekuens yang merinci alur kerja fitur ekspor data ke format CSV.

---

### 1. Alur Proses Ekspor ke CSV

Diagram ini menunjukkan interaksi antara komponen UI, hook, utilitas, dan state management saat pengguna mengekspor data.

```mermaid
sequenceDiagram
    title: Alur Proses Ekspor Data ke CSV
    actor User as "Pengguna"

    box "Frontend Components"
        participant View as "ExportCsv (View)<br>/Modals/File/ExportCsv/index.tsx"
        participant Hook as "useExportCsv<br>/Modals/File/ExportCsv/hooks/useExportCsv.ts"
        participant Utils as "exportCsvUtils<br>/Modals/File/ExportCsv/utils/exportCsvUtils.ts"
    end

    box "Zustand Stores"
        participant DataStore as "useDataStore"
        participant VarStore as "useVariableStore"
    end
    
    box "Browser APIs"
        participant Browser
    end

    autonumber

    Pengguna->>+View: Buka modal "Export to CSV"
    View->>+Hook: Inisialisasi hook `useExportCsv`
    Hook-->>-View: Mengembalikan state awal (opsi ekspor)
    View-->>Pengguna: Tampilkan modal dengan opsi

    loop Pengguna mengubah opsi
        Pengguna->>View: Ubah nama file atau opsi lainnya
        View->>+Hook: Panggil `handleChange()` atau `handleFilenameChange()`
        Hook->>Hook: Perbarui state `exportOptions`
        Hook-->>-View: Kembalikan state yang diperbarui
        deactivate Hook
    end

    Pengguna->>View: Klik tombol "Export"
    View->>+Hook: Panggil `handleExport()`
    Hook->>DataStore: Ambil data dari store
    DataStore-->>Hook: Kembalikan data
    Hook->>VarStore: Ambil variabel dari store
    VarStore-->>Hook: Kembalikan variabel
    
    Hook->>+Utils: Panggil `generateCsvContent(data, variables, options)`
    Utils-->>-Hook: Kembalikan konten string CSV
    
    Hook->>+Browser: Buat `new Blob([csvContent])`
    Browser-->>-Hook: Blob object
    Hook->>+Browser: Panggil `URL.createObjectURL(blob)`
    Browser-->>-Hook: Object URL
    Hook->>+Browser: Buat elemen `<a>`, atur `href` & `download`, lalu klik
    Browser-->>Pengguna: Munculkan dialog unduh file
    deactivate Browser
    Hook->>+Browser: Panggil `URL.revokeObjectURL(url)`
    deactivate Browser
    
    Hook->>View: Panggil `closeModal()` (via `useModal`)
    deactivate Hook
    View-->>-Pengguna: Tutup modal
    deactivate View
end
```

### 2.2. Penyempurnaan Model Objek (Object Model Refinements)

*Perubahan pada model objek (kelas, atribut, metode baru) yang ditemukan selama desain.*

- **Komponen Modal:**
  - `ExportCsv/index.tsx`: Komponen utama yang berisi semua opsi konfigurasi ekspor.
- **Hook Logika:**
  - `useExportCsv.ts`: Mengelola state semua opsi konfigurasi. Mengambil data dan metadata saat ini dari store (`useDataStore`, `useMetaStore`). Menggunakan `PapaParse` untuk mengubah array JSON menjadi string CSV. Membuat file `Blob` dan URL objek, lalu secara programatik memicu tautan unduhan.
- **Dependensi:**
  - `PapaParse`: Digunakan untuk "unparsing" (mengubah JSON ke CSV), yang merupakan kebalikan dari proses impor.

### 2.3. Catatan Alternatif Desain (Design Alternatives)

*Diskusi dan keputusan mengenai pilihan desain yang signifikan.*

- **Alternatif 1:** Mengirim data JSON ke backend untuk dibuatkan file CSV lalu diunduh.
  - **Kelebihan:** Mungkin mengurangi beban di klien jika data sangat besar.
  - **Kekurangan:** Memerlukan lalu lintas jaringan bolak-balik yang signifikan. Fitur ini dapat dengan mudah dan cepat dilakukan sepenuhnya di klien.
- **Keputusan:** Melakukan seluruh proses ekspor CSV di sisi klien. Ini jauh lebih cepat untuk pengguna karena tidak ada latensi jaringan, dan mengurangi beban pada server. 